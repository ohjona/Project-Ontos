---
id: v3_1_0_obsidian_compatibility_spec
type: strategy
status: draft
depends_on: [v3_0_implementation_roadmap]
concepts: [obsidian, wikilinks, graph-view, backlinks, interoperability]
---

# v3.1.0 Obsidian Compatibility Specification

**Status:** DRAFT - Pending Approval
**Target:** v3.1.0 "Bridge Features"
**Date:** 2026-01-13
**Scope:** Medium
**Author:** Chief Architect (Claude Opus 4.5)

---

## 1. Overview

Add Obsidian compatibility to Ontos, enabling users to leverage Obsidian's graph view, backlinks, and tag features with their Ontos knowledge base.

### 1.1 Design Principles

- **Additive, not replacement** — Keep existing fields, add Obsidian-compatible fields alongside
- **Opt-in by default** — `obsidian_mode: false` unless explicitly enabled
- **Auto-detection** — Suggest enabling when `.obsidian/` folder detected
- **Zero breaking changes** — Existing workflows continue unchanged

---

## 2. Scope (Medium)

### 2.1 IN Scope (v3.1.0)

| Feature | Description |
|---------|-------------|
| `tags` field | Mirror of `concepts` in frontmatter |
| `aliases` field | Alternative names for linking |
| `--obsidian` flag | CLI flag for `ontos map` command |
| `obsidian_mode` config | Setting in `.ontos.toml` |
| Wikilink generation | `[[doc_id]]` format in Context Map |
| Auto-detection | Suggest enable when `.obsidian/` exists |

### 2.2 OUT of Scope (Deferred to v3.2.x)

| Feature | Reason |
|---------|--------|
| Retrofit 314 existing documents | Scope creep |
| `ontos export --format obsidian` | Separate feature |
| `ontos init --obsidian` | Separate feature |
| Wikilinks in document body | Requires content transformation |

---

## 3. Frontmatter Changes

### 3.1 Field Mapping

```yaml
# BEFORE (Ontos native)
id: some_atom
type: atom
status: active
concepts: [architecture, design]
depends_on: [other_atom]

# AFTER (Obsidian compatible mode)
id: some_atom
type: atom
status: active
concepts: [architecture, design]      # Keep for Ontos
tags:                                  # Add for Obsidian
  - architecture
  - design
aliases:                               # Add for Obsidian
  - Some Atom
  - SA
depends_on: [other_atom]
```

### 3.2 Generation Rules

| Ontos Field | Obsidian Field | Rule |
|-------------|----------------|------|
| `concepts` | `tags` | Direct copy, remove `#` prefix if present |
| `id` | `aliases[0]` | Title-case the ID |
| (none) | `aliases[1+]` | User-defined in frontmatter |

---

## 4. Context Map Changes

### 4.1 Standard Format (default)

```markdown
## Documents

| Path | ID | Type |
|------|-----|------|
| docs/atoms/some_atom.md | some_atom | atom |

## Dependency Tree

- **some_atom**
  - other_atom
```

### 4.2 Obsidian Format (`--obsidian` or `obsidian_mode: true`)

```markdown
## Documents

| Path | ID | Type |
|------|-----|------|
| [[some_atom]] | some_atom | atom |

## Dependency Tree

- **[[some_atom]]**
  - [[other_atom]]
```

---

## 5. CLI Changes

### 5.1 New Flag: `--obsidian`

```bash
# Generate with Obsidian wikilinks
ontos map --obsidian

# Explicit standard format
ontos map --no-obsidian

# Use config setting (default)
ontos map
```

### 5.2 Auto-Detection UX

```
$ ontos map

Scanning docs/...
  Found 47 documents

Detected .obsidian/ folder. Enable Obsidian compatibility?
   This adds tags, aliases, and wikilinks to your Context Map.

   [y] Yes, enable  [n] No, keep standard  [?] Learn more

> y

Obsidian mode enabled. Saved to .ontos.toml
```

---

## 6. Configuration

### 6.1 `.ontos.toml` Addition

```toml
[obsidian]
enabled = false          # Default: opt-in
generate_tags = true     # Mirror concepts to tags
generate_aliases = true  # Generate aliases from id
wikilink_format = true   # Use [[wikilinks]] in output
```

### 6.2 `ontos_config.py` Fallback

```python
OBSIDIAN_MODE = False
OBSIDIAN_GENERATE_TAGS = True
OBSIDIAN_GENERATE_ALIASES = True
```

---

## 7. Implementation Plan

### 7.1 Files to Modify

| File | Change | Complexity |
|------|--------|------------|
| `ontos/core/frontmatter.py` | Add `normalize_tags()`, `normalize_aliases()` | Low |
| `ontos/core/types.py` | Add `ObsidianOptions` dataclass | Low |
| `ontos/commands/map.py` | Add wikilink output, `--obsidian` flag handling | Medium |
| `ontos/_scripts/ontos_generate_context_map.py` | Pass obsidian flag to `generate_context_map()` | Low |
| `ontos_config_defaults.py` | Add `OBSIDIAN_*` settings | Low |

### 7.2 New Files

| File | Purpose |
|------|---------|
| `ontos/io/obsidian.py` | Wikilink conversion utilities, vault detection |
| `tests/test_obsidian.py` | Unit tests for Obsidian features |

### 7.3 Estimated LOC

- New code: ~300-400 lines
- Modified code: ~100-150 lines
- Tests: ~200 lines

---

## 8. Testing Strategy

### 8.1 Unit Tests

| Test | Description |
|------|-------------|
| `test_normalize_tags` | Verify concepts -> tags mapping |
| `test_normalize_aliases` | Verify alias generation |
| `test_wikilink_format` | Verify `[[id]]` generation |
| `test_obsidian_detection` | Verify `.obsidian/` detection |
| `test_config_loading` | Verify obsidian settings from config |

### 8.2 Golden Master Extension

Add new fixtures:
- `golden/obsidian_small/` — Small vault with obsidian mode
- Compare standard vs obsidian output formats

### 8.3 Acceptance Criteria

| Criterion | Required |
|-----------|----------|
| Unit tests | 20+ new tests pass |
| Golden Master | 18/18 PASS (2 new) |
| No regressions | Standard mode unchanged |
| Config loading | Both `.ontos.toml` and `ontos_config.py` |

---

## 9. Migration Path

### 9.1 For New Users

1. Run `ontos init`
2. If `.obsidian/` detected, prompt to enable
3. Done — new documents get tags/aliases automatically

### 9.2 For Existing Users

1. Set `obsidian_mode: true` in config
2. Run `ontos map --obsidian` to regenerate Context Map
3. (v3.2.x) Run `ontos retrofit --obsidian` to update existing docs

---

## 10. Documentation

### 10.1 Updates Required

| Document | Change |
|----------|--------|
| `README.md` | Add Obsidian section |
| `Ontos_Manual.md` | Add Obsidian configuration section |
| `Ontos_Agent_Instructions.md` | Add `--obsidian` flag documentation |

### 10.2 New Documentation

| Document | Purpose |
|----------|---------|
| `docs/guides/obsidian-integration.md` | Full Obsidian setup guide |

---

## 11. Risks & Mitigations

| Risk | Mitigation |
|------|------------|
| Graph view expectations | Document that only Context Map has wikilinks in v3.1.0 |
| Performance with large vaults | Lazy tag generation, test with 300+ docs |
| Config complexity | Sensible defaults, single `enabled` flag |

---

## 12. Success Metrics

| Metric | Target |
|--------|--------|
| Context Map generates with wikilinks | Yes |
| Obsidian graph view shows connections | Yes |
| Tags appear in Obsidian tag pane | Yes |
| Aliases work for linking | Yes |
| No breaking changes to standard mode | Yes |

---

## 13. Verification Commands

```bash
# After implementation
python3 -m pytest tests/test_obsidian.py -v          # New tests pass
python3 tests/golden/compare_golden_master.py --fixture all  # 18/18 PASS
ontos map --obsidian                                  # Generates wikilinks
ontos map                                             # Standard format unchanged
```

---

## 14. References

| Document | Path |
|----------|------|
| Original Research | `.ontos-internal/archive/v2.9.6/Obsidian_Compatibility.md` |
| Initial Proposal | `.ontos-internal/strategy/proposals/Obsidian_Compatibility_Proposal.md` |
| v3.0 Roadmap | `.ontos-internal/strategy/v3.0/V3.0-Implementation-Roadmap.md` |

---

*Chief Architect (Claude Opus 4.5)*
