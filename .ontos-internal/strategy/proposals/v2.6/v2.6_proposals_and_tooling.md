---
id: v2_6_proposals_and_tooling
type: strategy
status: draft
depends_on: [v2_strategy]
concepts: [architecture, ontology, proposals, workflow, validation]
---

# V2.6 Proposal: Proposals Workflow & Validation

**Date:** 2025-12-17
**Author:** Claude Opus 4.5 (Architect)
**Status:** Draft - Round 2 (Post-Review Revision)
**Revision:** 3.0 - Incorporating Round 1 review feedback

---

## Revision History

| Version | Date | Changes |
|---------|------|---------|
| 1.0 | 2025-12-17 | Initial proposal with 3 new scripts |
| 2.0 | 2025-12-17 | Simplified: removed scripts, manual workflow |
| 3.0 | 2025-12-17 | Round 1 review amendments (Claude, Codex, Gemini) |

---

## 1. Executive Summary

This proposal extends Ontos v2.5 with:

1. **Rejection Recording** - Using existing decision_history.md format
2. **Status Validation** - `VALID_STATUS` enum with type-status matrix
3. **Schema Fixes** - Correcting event_type mismatch
4. **Lint Improvements** - Stale proposals, draft indicators, rejection enforcement
5. **Version Release Workflow** - Contributor-mode changelog reminder
6. **Complete Proposal Lifecycle** - Both approval and rejection workflows

**Key principle:** All features work in both contributor mode and user mode.

**What was removed:** Three new scripts - manual workflow with lint enforcement is simpler.

---

## 2. Problem Statement

### 2.1 Problems Identified

| # | Issue | Impact | Evidence | Status |
|---|-------|--------|----------|--------|
| P1 | Rejected ideas not recorded | Re-analyzing same ideas | No rejections in decision_history.md | Solving |
| P2 | No status validation | Invalid statuses accepted | No `VALID_STATUS` enum | Solving |
| P3 | Schema/config event_type mismatch | Confusion | Schema: `implementation` / Config: `feature` | Solving |
| P4 | No stale proposal detection | Proposals accumulate | No lint warning | Solving |
| P5 | Version releases miss changelog | v2.5.1, v2.5.2 missed | No reminder | Solving |
| P6 | Invalid type-status combinations | Semantic nonsense | `type: log, status: rejected` possible | **NEW** - Solving |
| P7 | Approved proposal workflow undefined | Where do they go? | Not documented | **NEW** - Solving |

### 2.2 What Already Exists (No Change Needed)

| Feature | Location |
|---------|----------|
| `proposals/` directory | Created by ontos_init.py |
| `status: draft` | In schema |
| Outcome column in decision_history | `Decision / Outcome` column |

---

## 3. Design Decisions

### 3.1 Rejection Recording (Using Existing Format)

**Current decision_history.md format (no change needed):**
```markdown
| Date | Slug | Event | Decision / Outcome | Impacted | Archive Path |
|:-----|:-----|:------|:-------------------|:---------|:-------------|
```

**Recording a rejection:**
```markdown
| 2025-12-17 | redis-cache | decision | REJECTED: Too complex for current scale. | v2_strategy | `archive/proposals/redis-cache.md` |
```

### 3.2 Status Validation with Type-Status Matrix

**Add to `ontos_config_defaults.py`:**

```python
# =============================================================================
# STATUS VALUES (v2.6+)
# =============================================================================

VALID_STATUS = {'draft', 'active', 'deprecated', 'archived', 'rejected'}

# Status descriptions - clarifying archived vs rejected
STATUS_DEFINITIONS = {
    'draft': 'Work in progress (proposals, incomplete docs)',
    'active': 'Current truth (approved, in use)',
    'deprecated': 'Past truth (superseded, kept for reference)',
    'archived': 'Historical record (completed logs moved to archive)',
    'rejected': 'Considered but NOT approved (proposals only - never became truth)',
}

# Valid (type, status) combinations - prevents semantic nonsense
# Example: type: log cannot have status: rejected (logs record what happened)
VALID_TYPE_STATUS = {
    'kernel': {'active', 'draft', 'deprecated'},
    'strategy': {'active', 'draft', 'deprecated', 'rejected'},  # Only strategy can be rejected
    'product': {'active', 'draft', 'deprecated'},
    'atom': {'active', 'draft', 'deprecated'},
    'log': {'active', 'archived'},  # Logs cannot be draft or rejected
}

# Stale thresholds (days)
PROPOSAL_STALE_DAYS = 60  # Configurable
```

**Rationale for type-status matrix (from Claude review):**
> "A `type: log` with `status: rejected` would be semantically invalid but pass validation."

This prevents nonsensical combinations at validation time.

### 3.3 Schema Fix (event_type Mismatch)

**Current schema.md (WRONG):**
```yaml
event_type: enum | exploration, decision, implementation, chore
```

**Corrected to match config:**
```yaml
event_type: enum | feature, fix, refactor, exploration, chore, decision
```

### 3.4 Complete Proposal Lifecycle

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           PROPOSAL LIFECYCLE                                 │
└─────────────────────────────────────────────────────────────────────────────┘

                              ┌─────────────┐
                              │   CREATE    │
                              │status: draft│
                              │ proposals/  │
                              └──────┬──────┘
                                     │
                              ┌──────▼──────┐
                              │   REVIEW    │
                              │(multi-model)│
                              └──────┬──────┘
                                     │
                      ┌──────────────┴──────────────┐
                      ▼                              ▼
             ┌────────────────┐            ┌────────────────┐
             │    APPROVE     │            │    REJECT      │
             └────────┬───────┘            └────────┬───────┘
                      │                              │
                      ▼                              ▼
             ┌────────────────┐            ┌────────────────┐
             │ 1. Change to   │            │ 1. Change to   │
             │ status: active │            │ status: rejected│
             │                │            │ 2. Add required │
             │ 2. Move to     │            │    metadata     │
             │ strategy/      │            │ 3. Move to      │
             │ (graduate)     │            │ archive/proposals│
             └────────┬───────┘            └────────┬───────┘
                      │                              │
                      └──────────────┬──────────────┘
                                     ▼
                              ┌─────────────┐
                              │  Record in  │
                              │decision_hist│
                              └─────────────┘
```

**Approval workflow (NEW - addressing Claude review gap):**
1. Change `status: draft` → `status: active`
2. Move file from `proposals/` to parent `strategy/` directory ("graduate")
3. Record in decision_history.md with `APPROVED` outcome

**Rejection workflow:**
1. Change `status: draft` → `status: rejected`
2. Add **required** rejection metadata (see 3.5)
3. Move file to `archive/proposals/`
4. Record in decision_history.md with `REJECTED` outcome

### 3.5 Rejection Metadata (Required Fields)

When rejecting a proposal, **required** frontmatter:

```yaml
---
id: redis_cache_proposal
type: strategy
status: rejected
rejected_date: 2025-12-17      # REQUIRED
rejected_reason: "Too complex"  # REQUIRED - whole point is capturing WHY
rejected_by: "Claude Opus 4.5"  # Optional - useful context
revisit_when: "10k users"       # Optional - conditions to reconsider
depends_on: [v2_strategy]
---
```

**Rationale for required `rejected_reason` (from Claude review):**
> "The whole point of recording rejections is to capture WHY."

Lint will warn if `status: rejected` without `rejected_reason`.

---

## 4. Deliverables

### 4.1 Config Changes

**File:** `.ontos/scripts/ontos_config_defaults.py`

Add `VALID_STATUS`, `STATUS_DEFINITIONS`, `VALID_TYPE_STATUS`, `PROPOSAL_STALE_DAYS` as shown in Section 3.2.

### 4.2 Schema Fix

**File:** `.ontos-internal/atom/schema.md`

1. Update status enum to include `rejected`
2. Fix event_type enum to match config
3. Add rejection metadata fields for strategy type

### 4.3 Context Map Updates

**File:** `.ontos/scripts/ontos_generate_context_map.py`

**4.3.1 Status Indicator**
```python
def get_status_indicator(status: str) -> str:
    """Return status indicator for non-active documents."""
    if status in ('draft', 'rejected', 'deprecated'):
        return f' [{status}]'
    return ''
```

**4.3.2 Status Validation (Wired to VALID_STATUS)**
```python
from ontos_config_defaults import VALID_STATUS, VALID_TYPE_STATUS

# Basic status validation
if status not in VALID_STATUS:
    warnings.append(f"- [LINT] **{doc_id}**: Invalid status '{status}'")

# Type-status combination validation
doc_type = data.get('type', 'unknown')
if doc_type in VALID_TYPE_STATUS:
    valid_statuses = VALID_TYPE_STATUS[doc_type]
    if status not in valid_statuses:
        warnings.append(
            f"- [LINT] **{doc_id}**: Invalid status '{status}' for type '{doc_type}' "
            f"(valid: {valid_statuses})"
        )
```

**4.3.3 Stale Proposal Warning (with mtime fallback)**
```python
from ontos_config_defaults import PROPOSAL_STALE_DAYS
from ontos_lib import get_git_last_modified
import os
from datetime import datetime

if status == 'draft' and 'proposals/' in filepath:
    # Try git date first, fall back to filesystem mtime
    last_modified = get_git_last_modified(filepath)
    if last_modified is None:
        # Fallback for new/untracked files
        mtime = os.path.getmtime(filepath)
        last_modified = datetime.fromtimestamp(mtime)

    age_days = (datetime.now() - last_modified).days
    if age_days > PROPOSAL_STALE_DAYS:
        warnings.append(
            f"- [LINT] **{doc_id}**: Draft proposal is {age_days} days old\n"
            f"  Action: Approve (move to strategy/, status: active) or "
            f"reject (move to archive/proposals/, status: rejected)"
        )
```

**Rationale for mtime fallback (from Codex review):**
> "New/untracked proposals will yield no date and skip warning."

**4.3.4 Skip Orphan Check for Draft Proposals Only**
```python
# Skip orphan check ONLY for draft proposals, not all drafts
if status == 'draft' and 'proposals/' in filepath:
    continue  # Proposals are naturally orphans until approved
```

**Rationale for proposal-specific skip (from Claude/Codex reviews):**
> "A draft `type: atom` with no dependents might be a real orphan, not an intentional proposal."

**4.3.5 Rejection Location Enforcement**
```python
if status == 'rejected':
    # Check required metadata
    if not frontmatter.get('rejected_reason'):
        warnings.append(
            f"- [LINT] **{doc_id}**: status: rejected requires 'rejected_reason' field"
        )

    # Check location
    if 'archive/proposals/' not in filepath:
        warnings.append(
            f"- [LINT] **{doc_id}**: Rejected proposals should be in archive/proposals/\n"
            f"  Action: Move to archive/proposals/ and record in decision_history.md"
        )
```

**Rationale for rejection enforcement (from Codex review):**
> "Nothing checks that `status: rejected` docs were moved to `archive/proposals/`"

**4.3.6 `--include-rejected` Flag**
```python
parser.add_argument('--include-rejected', action='store_true',
                    help='Include rejected proposals in context map')

# In document collection:
if status == 'rejected' and not args.include_rejected:
    continue  # Skip rejected by default
```

**Rationale (from all reviewers):**
> Default exclude to save tokens, but provide flag for historical recall.

### 4.4 Config Cleanup

**File:** `.ontos/scripts/ontos_config.py`

Remove `drafts/` from SKIP_PATTERNS (we use `proposals/`, not `drafts/`).

### 4.5 Version Release Workflow (Contributor-Mode Only)

**File:** `.ontos/scripts/ontos_pre_push_check.py`

```python
def check_version_reminder() -> list[str]:
    """Remind contributors to update changelog when shipping new versions.

    Simplified logic: warn on ANY .ontos/scripts/ change.
    Accepts false positives - better to remind unnecessarily than miss a release.
    """
    from ontos_config_defaults import is_ontos_repo

    if not is_ontos_repo():
        return []  # Skip for users

    # Get files changed in this push
    result = subprocess.run(
        ['git', 'diff', '--name-only', 'HEAD~1..HEAD'],  # Simpler than @{push}
        capture_output=True, text=True
    )
    if result.returncode != 0:
        return []

    changed_files = result.stdout.strip().split('\n')
    scripts_changed = any(f.startswith('.ontos/scripts/') for f in changed_files if f)

    if scripts_changed:
        return [
            "⚠️  CONTRIBUTOR REMINDER: .ontos/scripts/ modified\n"
            "   If shipping a new version, remember to update:\n"
            "   1. ONTOS_VERSION in ontos_config_defaults.py\n"
            "   2. Ontos_CHANGELOG.md with release notes\n"
        ]
    return []
```

**Rationale for simplified logic (from Claude review):**
> "Make it simpler: warn on ANY `.ontos/scripts/` change (accept false positives)"

### 4.6 Dual-Mode Matrix Document

**File:** `.ontos-internal/reference/Dual_Mode_Matrix.md`

Already created. Tracks dual-mode support for all features.

---

## 5. Dual-Mode Support

| Feature | Contributor | User |
|---------|-------------|------|
| proposals/ directory | `.ontos-internal/strategy/proposals/` | `docs/strategy/proposals/` |
| archive/proposals/ | `.ontos-internal/archive/proposals/` | `docs/archive/proposals/` |
| Status validation | ✅ | ✅ |
| Type-status validation | ✅ | ✅ |
| Stale proposal lint | ✅ | ✅ |
| Rejection enforcement lint | ✅ | ✅ |
| `--include-rejected` flag | ✅ | ✅ |
| Version release reminder | ✅ | ❌ (not applicable) |

---

## 6. File Changes Summary

| File | Change |
|------|--------|
| `.ontos/scripts/ontos_config_defaults.py` | Add VALID_STATUS, VALID_TYPE_STATUS, PROPOSAL_STALE_DAYS |
| `.ontos/scripts/ontos_generate_context_map.py` | Status indicator, validation, stale lint, rejection enforcement, --include-rejected |
| `.ontos/scripts/ontos_pre_push_check.py` | Version release reminder (contributor-mode) |
| `.ontos/scripts/ontos_config.py` | Remove `drafts/` from SKIP_PATTERNS |
| `.ontos-internal/atom/schema.md` | Fix event_type, add rejected status, rejection metadata |
| `.ontos-internal/reference/Dual_Mode_Matrix.md` | Already created |
| `Ontos_Manual.md` | Document proposal workflow (approve + reject) |
| `Ontos_Agent_Instructions.md` | Add proposal awareness |

---

## 7. Testing Plan

### 7.1 Unit Tests

| ID | Test | Mode | Expected |
|----|------|------|----------|
| T1 | Valid status values accepted | Both | No warning |
| T2 | Invalid status triggers lint warning | Both | Warning shown |
| T3 | Invalid type-status combo triggers warning | Both | Warning shown |
| T4 | Draft proposal shows [draft] indicator | Both | Indicator in context map |
| T5 | Stale draft (>60 days) triggers warning | Both | Lint warning with action hint |
| T6 | Fresh draft (<60 days) no warning | Both | No warning |
| T7 | Stale draft with no git history uses mtime | Both | Lint warning (mtime fallback) |
| T8 | Orphan check skips draft proposals | Both | No orphan warning |
| T9 | Orphan check runs on draft atoms | Both | Orphan warning if applicable |
| T10 | Version reminder runs in contributor mode | Contributor | Warning shown |
| T11 | Version reminder skipped in user mode | User | No warning |
| T12 | `status: rejected` without reason triggers warning | Both | Lint warning |
| T13 | `status: rejected` not in archive/ triggers warning | Both | Lint warning |
| T14 | `type: log, status: rejected` triggers warning | Both | Invalid combo warning |
| T15 | `--include-rejected` shows rejected docs | Both | Rejected docs in map |
| T16 | Default excludes rejected docs | Both | No rejected docs in map |

### 7.2 Integration Tests

| ID | Test | Expected |
|----|------|----------|
| T17 | Full lint run with mixed statuses | Correct warnings for each |
| T18 | Context map with proposals | [draft] indicators shown |
| T19 | Full approval workflow | Proposal graduates to strategy/ |
| T20 | Full rejection workflow | Proposal in archive/proposals/ with metadata |

---

## 8. Migration

### 8.1 Existing Documents

**No migration needed.** All changes are additive:
- Existing `status: active` documents work unchanged
- New validations are advisory (warnings, not errors)

### 8.2 Schema Event Type

Existing logs with `event_type: implementation` should be updated to `feature` or `chore`. Validation will warn but not fail.

---

## 9. Review Feedback Analysis

### 9.1 Round 1 Reviewers

| Reviewer | Verdict | Key Contributions |
|----------|---------|-------------------|
| Claude | APPROVE w/ amendments | Type-status matrix, required rejected_reason, approval workflow gap |
| Codex | CHANGES REQUIRED | VALID_STATUS wiring, mtime fallback, rejection enforcement |
| Gemini | APPROVED | Semi-automation idea, SRP for lint, actionable warnings |

### 9.2 Feedback Adopted

| # | Feedback | Source | Implementation |
|---|----------|--------|----------------|
| A1 | Make `rejected_reason` required | Claude | Section 3.5, 4.3.5 |
| A2 | Document approval workflow | Claude | Section 3.4 (graduate to strategy/) |
| A3 | Add type-status validation matrix | Claude | Section 3.2 (VALID_TYPE_STATUS) |
| A4 | Wire VALID_STATUS explicitly | Codex | Section 4.3.2 |
| A5 | Fallback to filesystem mtime | Codex | Section 4.3.3 |
| A6 | Add lint for rejected location | Codex | Section 4.3.5 |
| A7 | Orphan skip proposal-specific | Claude, Codex | Section 4.3.4 |
| A8 | Add `--include-rejected` flag | Claude, Codex | Section 4.3.6 |
| A9 | Clarify archived vs rejected | Gemini | Section 3.2 (STATUS_DEFINITIONS) |
| A10 | Make lint warnings actionable | Gemini | Section 4.3.3, 4.3.5 |
| A11 | Add tests T12-T16 | Claude | Section 7.1 |

### 9.3 Feedback Refined (Adjusted Approach)

| # | Feedback | Source | Original | Refinement | Rationale |
|---|----------|--------|----------|------------|-----------|
| R1 | Semi-automated rejection helper | Gemini | Add `--reject` to maintain.py | Lint prints actionable message | Avoids new tooling while providing guidance |
| R2 | Dedicated ontos_lint.py | Gemini | Separate script | Defer to v2.7 | Good SRP but scope creep for v2.6 |
| R3 | `rejected_by` auto-populate | Gemini | Auto from get_source() | Keep optional | Useful context, not critical for all rejections |
| R4 | CI check for Dual_Mode_Matrix.md | Gemini | Pre-commit hook | Document in matrix itself | Over-engineering for now |
| R5 | Version reminder parse actual version | Claude | Parse ONTOS_VERSION diff | Accept false positives | Simpler, reliability > precision |

### 9.4 Feedback Not Adopted

| # | Feedback | Source | Reason for Not Adopting |
|---|----------|--------|------------------------|
| N1 | Proposal ID naming convention | Claude | Over-specification - flexibility is appropriate for varying project conventions |
| N2 | Dual_Mode_Matrix.md in user-visible docs/ | Claude | It's contributor reference - users don't need internal mode details |
| N3 | Concepts template drift risk | Codex | Already handled by template loader in v2.5.2 - templates.py loads from canonical source |

---

## 10. Open Questions (Round 2)

### Q1: `--include-rejected` vs `--include-archived`

Claude suggested combining into one flag:
> "`--include-archived` flag: includes rejected AND archived"

| Option | Behavior | Pros | Cons |
|--------|----------|------|------|
| A: Separate flags | `--include-rejected`, `--include-archived` | Granular control | Two flags to remember |
| B: Combined flag | `--include-archived` gets both | Simpler | Less control |
| C: `--include-historical` | New umbrella flag | Clear intent | Yet another name |

**Architect recommendation:** Option A (separate) - rejected proposals and archived logs serve different purposes.

**Question for reviewers:** Do you agree with separate flags, or prefer combined?

### Q2: Approved Proposal Location

When a proposal is approved, where should it go?

| Option | Destination | Pros | Cons |
|--------|-------------|------|------|
| A: Graduate to strategy/ | `strategy/approved_proposal.md` | Clean separation from drafts | Might clutter strategy/ |
| B: Stay in proposals/ | `proposals/approved_proposal.md` | No file movement | Confusing - why is "active" in proposals? |
| C: Merge into existing doc | Absorbed into relevant strategy doc | No new files | Loses proposal history |

**Architect recommendation:** Option A (graduate to strategy/) - mirrors rejection workflow symmetry.

**Question for reviewers:** Confirm Option A, or suggest alternative?

### Q3: Should Lint Block or Warn?

Current design: All lint issues are warnings (advisory).

| Option | Behavior | Use Case |
|--------|----------|----------|
| A: Always warn | Never blocks | Maximum flexibility |
| B: `--strict` flag errors | Opt-in blocking | CI enforcement |
| C: Some rules error by default | Invalid status = error | Enforce data integrity |

**Architect recommendation:** Option B (`--strict` flag) - matches existing pattern.

**Question for reviewers:** Any rules that should error by default (Option C)?

---

## 11. Approval Checklist

| Reviewer | Round 1 | Round 2 | Notes |
|----------|---------|---------|-------|
| Claude (Architect) | REVISED | AUTHOR | v3.0 incorporating feedback |
| Claude Reviewer | APPROVED w/ amendments | PENDING | Amendments addressed |
| Codex | CHANGES REQUIRED | PENDING | Changes implemented |
| Gemini | APPROVED | PENDING | Refinements noted |
| Human (Jonathan) | PENDING | PENDING | — |

---

## 12. Implementation Priority

Based on review consensus:

| Priority | Deliverable | Rationale |
|----------|-------------|-----------|
| P0 | Type-status validation matrix | Prevents semantic nonsense |
| P0 | Wire VALID_STATUS in context map | Without this, enum is dead code |
| P0 | Rejection enforcement lint | Ensures workflow compliance |
| P1 | Stale proposal lint with mtime fallback | Core value proposition |
| P1 | Approval/rejection workflow documentation | Completes lifecycle |
| P1 | `--include-rejected` flag | Discoverability without bloat |
| P2 | Version release reminder | Contributor convenience |
| P2 | Schema event_type fix | Cleanup |

---

## 13. References

- [Round 1 Review: Claude](Claude_2.6_v1.md)
- [Round 1 Review: Codex](Codex_2.6_v1.md)
- [Round 1 Review: Gemini](Gemini_2.6_v1.md)
- [Session Log: Proposals Architecture](../../logs/2025-12-17_v2-5-1-proposals-architecture.md)
- [Dual Mode Matrix](../../reference/Dual_Mode_Matrix.md)
- [Schema Specification](../../atom/schema.md)
