---
id: v2_9_5_adversarial_review
type: strategy
status: draft
depends_on: [v2_9_5_implementation_plan]
concepts: [architecture, quality, testing]
---

# Adversarial Review: Project Ontos v2.9.5 Implementation Plan

Reviewer: Codex (GPT-5)

## Verdict: REJECT

## Complexity Findings (REQUIRED)

### Speculative Generality: Found
- `_warn_deprecated()` returns `Optional[str]` and the spec invents three routing options (OutputHandler, ctx.warn, callback) without a single concrete consumer. That is interface inflation for exactly three internal callers in `.ontos/scripts/ontos/core/paths.py` and no requirement for multiple implementations. Pick one path and delete the rest.

### Resume-Driven Development: Found
- The test suite locks onto implementation details (temp filename suffix, direct tests of `_acquire_lock()` / `_release_lock()`) instead of user-visible behavior. This is heavyweight for a quality release and makes later refactors brittle.

### Premature Abstraction: Found
- The warning-string return is an abstraction without a defined consumer. The call sites in `.ontos/scripts/ontos/core/paths.py` do not have `OutputHandler` or `SessionContext`, so the plan either forces new plumbing or drops warnings silently.

## Attack Vectors
- The proposed `TestFromRepo` patches `resolve_config`, but `SessionContext.from_repo()` never calls it; it imports `ontos_config` directly. This test will fail, contradicting the "expect 0 failures" step.
- Commit cleanup can delete source files for MOVE operations. In `.ontos/scripts/ontos/core/context.py`, MOVE stages `(source, destination)` and cleanup deletes any staged `temp` not equal to `final`. On a failure after staging, the original source can be unlinked. The spec ignores this data-loss risk while claiming atomicity.
- Locking tests rely on real timeouts and PID liveness, which are flaky in CI and will produce nondeterministic failures.

## Demanded Changes
- Delete the multi-option warning handling. Specify a single warning propagation path and implement it. No side-option list in the spec.
- Remove or rewrite tests that assert internal mechanics. Delete temp-suffix assertions and direct tests of `_acquire_lock()` / `_release_lock()`; replace with behavioral tests around `commit()` and public methods.
- Fix the test plan to match the current code. Either change `SessionContext.from_repo()` to use a helper that can be patched, or update the test to patch `ontos_config`.
- Move the "quiet flag on errors" change out of scope unless there is a hard user requirement; it is a behavior change that can hide failures.

## Residual Concerns
- Even if the above changes land, the current MOVE cleanup behavior can cause data loss on commit failure. This undermines the "atomic" claim and should be addressed before v3.0 exposure.
- PID-based stale lock detection relies on `os.kill(pid, 0)` and real timeouts, which are not reliable across platforms or CI. The design should include a deterministic test strategy or accept risk explicitly.
